<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Software - Software Management Portal</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <nav class="navbar">
        <div class="nav-brand">
            <h1>üñ•Ô∏è Software Management Portal</h1>
        </div>
        <ul class="nav-menu">
            <li><a href="{{ url_for('index') }}">Dashboard</a></li>
            <li><a href="{{ url_for('software_list') }}" class="active">Software</a></li>
            <li><a href="{{ url_for('rooms_list') }}">Rooms</a></li>
            <li><a href="{{ url_for('my_assignments') }}">{% if current_user.is_superuser %}Assignments{% else %}My Assignments{% endif %}{% if pending_assignments_count > 0 %}<span class="notification-badge">{{ pending_assignments_count }}</span>{% endif %}</a></li>
            {% if current_user.is_superuser %}
            <li><a href="{{ url_for('compliance_report') }}">Compliance</a></li>
            <li><a href="{{ url_for('users_list') }}">Users</a></li>
            {% endif %}
            <li class="user-info">
                {{ current_user.username }}
                {% if current_user.is_superuser %}
                <span class="badge badge-admin">Admin</span>
                {% endif %}
            </li>
            <li><a href="{{ url_for('logout') }}" class="btn-sm btn-secondary">Logout</a></li>
        </ul>
    </nav>

    <div class="container">
        <div class="page-header">
            <h2>Add New Software</h2>
        </div>

        <div class="form-container">
            <form method="post" enctype="multipart/form-data" class="software-form">
                <div class="form-row">
                    <div class="form-group">
                        <label>Software Name *</label>
                        <input type="text" name="software_name" required>
                    </div>
                    <div class="form-group">
                        <label>Version *</label>
                        <input type="text" name="version" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Vendor</label>
                        <input type="text" name="vendor">
                    </div>
                    <div class="form-group">
                        <label>License Type</label>
                        <select name="license_type">
                            <option value="">Select...</option>
                            <option value="Site">Site License</option>
                            <option value="Volume">Volume License</option>
                            <option value="Per-User">Per-User</option>
                            <option value="Per-Device">Per-Device</option>
                            <option value="Free">Free/Open Source</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>License Key</label>
                        <input type="text" name="license_key" placeholder="Enter license key if applicable">
                    </div>
                    <div class="form-group">
                        <label>License Count</label>
                        <input type="number" name="license_count" value="0" placeholder="Number of licenses (-1 for unlimited)">
                    </div>
                </div>

                <div class="form-group">
                    <label>Description</label>
                    <textarea name="description" rows="3" placeholder="Software description and notes"></textarea>
                </div>

                <div class="form-group">
                    <label>Installer File (Upload)</label>
                    <input type="file" name="installer" accept=".exe,.msi,.dmg,.pkg,.deb,.rpm,.zip" id="installer_file" onchange="clearUrlField()">
                    <small class="text-muted">Max 500MB. Supported formats: .exe, .msi, .dmg, .pkg, .deb, .rpm, .zip</small>
                </div>

                <div class="form-group">
                    <label>OR Installer URL (Link)</label>
                    <input type="url" name="installer_url" id="installer_url" placeholder="https://example.com/installer.exe" onchange="clearFileField()">
                    <small class="text-muted">Provide a direct link to the installer if not uploading a file</small>
                </div>

                <script>
                    function clearUrlField() {
                        if (document.getElementById('installer_file').value) {
                            document.getElementById('installer_url').value = '';
                        }
                    }
                    function clearFileField() {
                        if (document.getElementById('installer_url').value) {
                            document.getElementById('installer_file').value = '';
                        }
                    }
                </script>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Add Software</button>
                    <a href="{{ url_for('software_list') }}" class="btn btn-outline">Cancel</a>
                </div>
            </form>
        </div>
    </div>
</body>
</html>
